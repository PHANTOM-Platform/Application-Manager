<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>PHANTOM REPOSITORY</title>
	<style>
		ul.menuphantom {
			list-style-type: none;
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #333;
		}

		li.menuphantom {
			float: left;
			padding: 14px 16px;
		}
		
		li.phantomlogo{
			padding: 7px 10px 0px 0px;
		}

		li a {
			display: block;
			color: white;
			text-align: center;
			text-decoration: none;
		}

		li a:hover {
			background-color: #111;
		}
		
hr.double {
	border-top: 2px solid #8c8b8b;
	border-bottom: 1px solid #fff;
}
hr.double:after {
	content: '';
	display: block;
	margin-top: 2px;
	border-top: 2px solid #8c8b8b;
	border-bottom: 2px solid #fff;
}


	
table, td, th {
	border: 0px solid black;
}
tr:nth-child(even){background-color: #f2f2f2}

th {
	background-color: #0d98ff;
	color: white;
}	
</style>

<style>
img {
	padding: 0px;
}
</style>

</head>
<body style="margin:0;">

<div id="menu_phantom">
<ul class="menuphantom">
		<li class="menuphantom"><a href="upload_file.html">Upload File</a></li>
		<li class="menuphantom"><a href="example.json">Download example.json</a></li>
		<li class="menuphantom"><a class="active" href="download_file.html">Download File</a></li>
		<li class="menuphantom"><a href="query_metadata.html">Query metadata</a></li>
		<li class="phantomlogo" style="float:right" ><a class="active" href="#about"> 
		<img src="phantom.gif" alt="PHANTOM" height="32" border="0" style="background-color:white;"> 
			</a></li>
</ul></div>

<h1><b>LIST OF Registered APPs</b>
</h1>

<script type="text/javascript">
var s = 'a string', a = [], o = {}, i = 5;
function getType(p) {
	if (Array.isArray(p)) return 'array';
	else if (typeof p == 'string') return 'string';
	else if (p != null && typeof p == 'object') return 'object';
	else return 'other';
}

var count =1;
function jsontotableb(myjson){
	var html ="";
	myjson.forEach(function(val) {
		var keys = Object.keys(val);
		keys.forEach(function(key) {
			if ( getType(val[key]) == "string"  ||  getType(val[key]) == "other" ) { 
				html += "<td><strong>" + key + "</strong>: " + val[key] + "</td>";
			};
		});
	});
	return html;
}

function jsontotable(myjson){
	var html ="";             
	myjson.forEach(function(val) {
		var keys = Object.keys(val);
		html += "<div class = 'cat'><table>"; // style='width:100%'>";
		count =1;	 
		keys.forEach(function(key) {
			if ( getType(val[key]) == "string"  ||  getType(val[key]) == "other" ){
			if( key != "project_length" ){
				if(count == 1) { 
					html += "<tr><th><strong>" + key + "</strong>: " + val[key] + "</th></tr>";
				} else{
					html += "<tr><td><strong>" + key + "</strong>: " + val[key] + "</td></tr>";	
				}
				count = count +1 ;
			}}else if ( getType(val[key]) == "object" ) {
				newjson = JSON.stringify(val[key])  ;
				html += "<tr><td><strong> &emsp; " + key + "</strong>: </td>" ;		
				html += jsontotableb( [ val[key] ] ) +"</tr>";
			};
		});
		html += "</table></div><br>";
	});
	return html;
}

function jsontohtml(myjson){
	var html ="[";
	var newquery = 1 ;
	myjson.forEach(function(val) {
		if ( newquery == 0 ) { html += ",</div><br>" }; 
		newquery = 0 ;	
		var keys = Object.keys(val);
		html += "<div class = 'cat'>{"; 
		count =1;
		keys.forEach(function(key) {
			if ( getType(val[key]) == "string"  ||  getType(val[key]) == "other" ){
			if( key != "project_length" ){
				if (count != 1) html += ',<br>&emsp;';
				html += "<strong>\"" + key + "\"</strong>: \"" + val[key] +"\"";
				count = count +1 ;
			}}else if ( getType(val[key]) == "object" ) {
				if (count != 1) html += ',<br>&emsp;';                                        
				newjson = JSON.stringify(val[key])  ;
				html += "<strong>\"" + key + "\"</strong>: \"" + JSON.stringify(val[key]) +"\"" ;
				//html += jsontotableb( [ val[key] ] ) +"</tr>";
			};
		});
		html += "<br>}";
	});
	html += "</div><br>]"; 
	return html;
}


function myresults(mytype,appname){   
	var url="http://localhost:8500/get_app_list?project=\""+appname+"\""; //?pretty='true'"; 
	var xhr = new XMLHttpRequest(); 
	xhr.open("GET", url, true);
	xhr.onreadystatechange = function() {
	var html = ""; // to store the conversion of json to html format 
		if (xhr.readyState === 4 && xhr.status == 200) { 
			var serverResponse = xhr.responseText;
			// document.getElementById('demoreplacea').innerHTML = serverResponse; //this will show the reponse of the server as txt;
			
			var myjson = JSON.parse(serverResponse);
			if(myjson.hits!=undefined) {
			myjson = myjson.hits;
			}else{
				myjson = [ myjson ];
			}
			if(myjson!=undefined) {
				if (mytype== 1) {
					html += jsontotable(myjson);
				}else if (mytype == 2){
					html += jsontohtml(myjson);
				}else{
					html += JSON.stringify(myjson) ;
				} 
			}
			//document.getElementById('demoreplaceb').innerHTML = JSON.stringify(myjson) + "<br>" + html ;// myjson[0].project;
			document.getElementById('demoreplaceb').innerHTML = html;
		}
	};
	xhr.send(null);
	return false;
}
</script>

<h2><b> Online formular: Retrieve List of APPs</b></h2>
	<form ref='queryForm'
	id='queryForm'
	method='get'
	name="myForm"
	encType="multipart/form-data">
	<center>
	APP name (optional): <input type="text" name="appname" id="appname" value="demo_hpc"> leave empty if not wish to filter by name<br> 
	<input type="hidden" name="pretty" value="true">
	<!-- upload button-->
	<input type="submit" onclick="return myresults(1,document.getElementById('appname').value)" value="Show results in Table" />
	<input type="submit" onclick="return myresults(2,document.getElementById('appname').value)" value="Show results as JSON" />
	<input type="submit" onclick="return myresults(3,document.getElementById('appname').value)" value="Show raw reply from server" />
</center> 
</form>

<hr> 
<!--<b>Tested command line example with curl:</b>
<p style="color:DodgerBlue;">
curl -XGET 'http://localhost:8000/query_metadata?Path=mypath%2F&filename=main.c'
</p>-->

<p id="demoreplaceb"></p>

<hr>
<br>
<p><font size="2">PHANTOM project: 2018</font></p> 
</body>
</html>
